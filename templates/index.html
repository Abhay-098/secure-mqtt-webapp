<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>üîí Secure MQTT Web App (TLS + Client Certs)</title>
  <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-900 text-white min-h-screen p-6">
  <div class="max-w-3xl mx-auto space-y-6">
    <h1 class="text-3xl font-bold text-center">üîí Secure MQTT Web App</h1>
    <p class="text-center text-gray-400">(TLS + Client Certificates)</p>

    <!-- Certificate section -->
    <div class="bg-slate-800 p-4 rounded-lg shadow-lg">
      <h2 class="text-xl font-semibold mb-2">1Ô∏è‚É£ Generate Certificates</h2>
      <p class="text-gray-300 text-sm mb-3">Creates demo CA, broker, and client certificates.</p>
      <button id="genBtn" class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-lg">Generate Certificates</button>
      <p id="genOutput" class="mt-3 text-green-400"></p>
    </div>

    <!-- Client section -->
    <div class="bg-slate-800 p-4 rounded-lg shadow-lg">
      <h2 class="text-xl font-semibold mb-2">2Ô∏è‚É£ Start MQTT Client</h2>
      <label class="block mb-2">Mode:</label>
      <select id="mode" class="text-black px-2 py-1 rounded">
        <option value="pub">Publisher</option>
        <option value="sub">Subscriber</option>
      </select>

      <label class="block mt-2">Client ID:</label>
      <input id="client" value="client1" class="text-black px-2 py-1 rounded w-full" />

      <label class="block mt-2">Topic:</label>
      <input id="topic" value="/vit/test" class="text-black px-2 py-1 rounded w-full" />

      <label class="block mt-2">Payload:</label>
      <input id="payload" value="Hello Secure MQTT!" class="text-black px-2 py-1 rounded w-full" />

      <div class="mt-3">
        <input type="checkbox" id="tls" /> <label for="tls">Use TLS (Encrypted)</label>
      </div>

      <button id="startBtn" class="bg-green-600 hover:bg-green-700 mt-3 px-4 py-2 rounded-lg">Start Client</button>
    </div>

    <!-- Live output -->
    <div class="bg-black p-3 rounded-lg font-mono h-64 overflow-y-auto" id="logBox"></div>
  </div>

  <script>
    const socket = io();
    socket.on('mqtt_log', (data) => {
      const box = document.getElementById('logBox');
      box.innerHTML += data.line + "<br>";
      box.scrollTop = box.scrollHeight;
    });

    document.getElementById('genBtn').onclick = async () => {
      const res = await fetch('/generate', { method: 'POST' });
      const data = await res.json();
      document.getElementById('genOutput').textContent = data.output;
    };

    document.getElementById('startBtn').onclick = async () => {
      const body = {
        mode: document.getElementById('mode').value,
        client: document.getElementById('client').value,
        topic: document.getElementById('topic').value,
        payload: document.getElementById('payload').value,
        use_tls: document.getElementById('tls').checked
      };
      const res = await fetch('/start_client', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(body)
      });
      const data = await res.json();
      document.getElementById('logBox').innerHTML += 
        `Started client (${body.use_tls ? "Secure TLS" : "Unsecure"}) ‚Üí ${JSON.stringify(data)}<br>`;
    };
  </script>
</body>
</html>
